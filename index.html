<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vești bune</title>
  <meta name="description" content="România (RO) + Global (EN) — doar vibe bun." />
  <style>
    :root{
      --bg:#0b0d10; --card:#12161b; --muted:#a8b0bb; --text:#e9eef6; --line:#1f2630;
      --accent:#7c5cff; --accent2:#22c55e; --warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap}
    .pill{border:1px solid var(--line);background:transparent;color:var(--text);padding:8px 10px;border-radius:999px;font-size:13px;cursor:pointer}
    .pill.active{background:rgba(124,92,255,.18);border-color:rgba(124,92,255,.45)}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:14px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .photo{position:relative;height:170px;background:#0f1318}
    .photo img{width:100%;height:100%;object-fit:cover;display:block}
    .tag{position:absolute;left:10px;bottom:10px;background:rgba(0,0,0,.55);backdrop-filter:blur(8px);
      padding:6px 10px;border-radius:999px;font-size:12px;display:flex;align-items:center;gap:8px}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent2);display:inline-block}
    .body{padding:12px 12px 14px}
    .title{margin:0;font-weight:700}
    .small{margin:6px 0 0;color:var(--muted);font-size:13px}
    .section{margin-top:18px}
    .section h2{margin:0 0 10px;font-size:16px}
    .meta{color:var(--muted);font-size:12px;margin-top:2px}
    .newslist{display:flex;flex-direction:column;gap:10px}
    .item{display:grid;grid-template-columns:120px 1fr;gap:12px;padding:10px;border:1px solid var(--line);
      border-radius:14px;background:rgba(255,255,255,.02)}
    .thumb{width:120px;height:82px;border-radius:12px;overflow:hidden;background:#0f1318;border:1px solid rgba(255,255,255,.06)}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .ititle{margin:0;font-weight:700;font-size:14px;line-height:1.25}
    .isum{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.3}
    .isrc{margin:8px 0 0;color:var(--muted);font-size:12px;display:flex;gap:10px;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.10);font-size:12px}
    .bacc{border-color:rgba(124,92,255,.45);background:rgba(124,92,255,.14)}
    .bwarn{border-color:rgba(251,191,36,.45);background:rgba(251,191,36,.12)}
    .muted{color:var(--muted)}
    .box{padding:12px}
    .quote{font-size:14px;line-height:1.35;margin:0}
    .sourceLine{margin-top:10px;font-size:12px;color:var(--muted)}
    .sourceLine a{color:rgba(124,92,255,.95)}
    @media (max-width:900px){
      .grid3{grid-template-columns:1fr}
      .grid2{grid-template-columns:1fr}
      .item{grid-template-columns:92px 1fr}
      .thumb{width:92px;height:70px}
      .photo{height:160px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h1>Vești bune</h1>
        <div class="sub">România (RO) + Global (EN)</div>
        <div class="meta">Data: <a class="muted" href="data/news.json">news.json</a> • Ultima actualizare: <span id="updated">—</span></div>
      </div>

      <div class="pillrow" id="filters">
        <button class="pill active" data-mode="mix">Mix</button>
        <button class="pill" data-mode="ro">RO</button>
        <button class="pill" data-mode="en">EN</button>
      </div>
    </div>

    <!-- TOP PHOTOS -->
    <div class="grid3" id="topPhotos">
      <div class="card">
        <div class="photo">
          <img alt="Space" id="imgSpace" src="https://source.unsplash.com/featured/1200x800/?space,stars,nebula" />
          <div class="tag"><span class="dot"></span> Space</div>
        </div>
        <div class="body">
          <p class="title">Top poze</p>
          <p class="small">space / animals / landscape</p>
        </div>
      </div>

      <div class="card">
        <div class="photo">
          <img alt="Animals" id="imgAnimals" src="https://source.unsplash.com/featured/1200x800/?animals,cute" />
          <div class="tag"><span class="dot"></span> Animals</div>
        </div>
        <div class="body">
          <p class="title">Doar vibe bun</p>
          <p class="small">poze fresh, fără API keys</p>
        </div>
      </div>

      <div class="card">
        <div class="photo">
          <img alt="Landscape" id="imgLandscape" src="https://source.unsplash.com/featured/1200x800/?landscape,nature,mountains" />
          <div class="tag"><span class="dot"></span> Landscape</div>
        </div>
        <div class="body">
          <p class="title">Reset mental</p>
          <p class="small">3 carduri sus, ca înainte</p>
        </div>
      </div>
    </div>

    <!-- JOKE + SATIRE -->
    <div class="grid2">
      <div class="card">
        <div class="box">
          <h2 style="margin:0 0 8px">Gluma zilei</h2>
          <p class="quote" id="jokeText">Se încarcă…</p>
          <div class="sourceLine">Sursă: <span id="jokeSource">—</span></div>
        </div>
      </div>

      <div class="card">
        <div class="box">
          <h2 style="margin:0 0 8px">Satira zilei</h2>
          <p class="quote"><a id="satireLink" href="#" target="_blank" rel="noopener">Se încarcă…</a></p>
          <div class="sourceLine">Sursă: <span id="satireSource">—</span></div>
        </div>
      </div>
    </div>

    <!-- NEWS -->
    <div class="section">
      <h2 id="modeTitle">Mix RO + EN</h2>
      <div class="newslist" id="newsList">
        <div class="muted">Se încarcă știrile…</div>
      </div>
    </div>
  </div>

<script>
  const state = { mode: "mix", data: null };

  function setMode(mode){
    state.mode = mode;
    document.querySelectorAll("#filters .pill").forEach(b=>{
      b.classList.toggle("active", b.dataset.mode === mode);
    });
    render();
  }

  function pickTopPhotos(topImages){
    if(!Array.isArray(topImages) || topImages.length < 3) return;

    const byTag = {};
    topImages.forEach(x => { if(x && x.tag) byTag[x.tag] = x; });

    const s = byTag.space, a = byTag.animals, l = byTag.landscape;
    if(s?.image) document.getElementById("imgSpace").src = s.image;
    if(a?.image) document.getElementById("imgAnimals").src = a.image;
    if(l?.image) document.getElementById("imgLandscape").src = l.image;
  }

  function renderJokeSatire(){
    const d = state.data || {};
    const joke = d.joke_ro;
    const satire = d.satire_ro;

    if(joke && joke.text){
      document.getElementById("jokeText").textContent = joke.text;
      document.getElementById("jokeSource").textContent = joke.source || "—";
    } else {
      document.getElementById("jokeText").textContent = "—";
      document.getElementById("jokeSource").textContent = "—";
    }

    if(satire && satire.title){
      const a = document.getElementById("satireLink");
      a.textContent = satire.title;
      a.href = satire.link || "#";
      document.getElementById("satireSource").textContent = satire.source || "—";
    } else {
      document.getElementById("satireLink").textContent = "—";
      document.getElementById("satireLink").href = "#";
      document.getElementById("satireSource").textContent = "—";
    }
  }

  function fmtDate(iso){
    if(!iso) return "—";
    try{
      const d = new Date(iso);
      return d.toLocaleString("ro-RO", { dateStyle:"medium", timeStyle:"short" });
    }catch(e){ return "—"; }
  }

  function isRO(item){
    return (item.kind === "ro") || (item.section === "romania");
  }
  function isEN(item){
    return (item.kind === "global") && (item.section !== "romania");
  }

  function buildItemHTML(it){
    const title = it.title_ro || it.title || "";
    const summary = it.summary_ro || it.summary || "";
    const img = it.image || "";
    const src = it.source || "";
    const when = it.published_utc ? fmtDate(it.published_utc) : "";

    return `
      <a class="item" href="${it.link}" target="_blank" rel="noopener">
        <div class="thumb">${img ? `<img src="${img}" alt="">` : ""}</div>
        <div>
          <p class="ititle">${escapeHtml(title)}</p>
          <p class="isum">${escapeHtml(summary)}</p>
          <div class="isrc">
            <span class="badge bacc"> ${escapeHtml(src)} </span>
            <span class="badge bwarn"> ${escapeHtml(when)} </span>
          </div>
        </div>
      </a>
    `;
  }

  function escapeHtml(s){
    return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
  }

  function gather(mode, sections){
    const items = [];
    const pushAll = (arr)=>{ (arr||[]).forEach(x=>x && items.push(x)); };

    if(mode === "ro"){
      pushAll(sections.romania);
      return items.filter(isRO);
    }
    if(mode === "en"){
      pushAll(sections.medical);
      pushAll(sections.science);
      pushAll(sections.environment);
      return items.filter(isEN);
    }

    // mix
    pushAll(sections.romania);
    pushAll(sections.medical);
    pushAll(sections.science);
    pushAll(sections.environment);
    return items;
  }

  function render(){
    const d = state.data || {};
    const sections = d.sections || {};
    const list = document.getElementById("newsList");
    const title = document.getElementById("modeTitle");

    title.textContent = state.mode === "mix" ? "Mix RO + EN" : (state.mode === "ro" ? "România (RO)" : "Global (EN)");

    const items = gather(state.mode, sections)
      .sort((a,b)=> (b.published_utc||"").localeCompare(a.published_utc||""));

    if(!items.length){
      list.innerHTML = `<div class="muted">Nu sunt știri pentru filtrul curent.</div>`;
      return;
    }
    list.innerHTML = items.map(buildItemHTML).join("");
  }

  async function init(){
    document.querySelectorAll("#filters .pill").forEach(btn=>{
      btn.addEventListener("click", ()=> setMode(btn.dataset.mode));
    });

    try{
      const r = await fetch("data/news.json", { cache: "no-store" });
      const d = await r.json();
      state.data = d;

      document.getElementById("updated").textContent = fmtDate(d.generated_utc);
      pickTopPhotos(d.top_images);
      renderJokeSatire();
      render();
    }catch(e){
      document.getElementById("newsList").innerHTML = `<div class="muted">Eroare la încărcare.</div>`;
    }
  }
  init();
</script>
</body>
</html>
