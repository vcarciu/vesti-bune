<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ve»ôti bune</title>
  <meta name="description" content="Agregator de ve»ôti (√Æn principal) pozitive, actualizat automat. Rom√¢nia + global (EN), surse verificate." />
  <meta name="robots" content="index,follow" />

  <!-- Open Graph (best-effort) -->
  <meta property="og:title" content="Ve»ôti bune" />
  <meta property="og:description" content="»òtiri (√Æn principal) pozitive, actualizate automat. Rom√¢nia + global (EN)." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="./og.jpg" />

  <link rel="icon" href="./favicon.ico" />
  <style>
    :root {
      --bg:#fafafa;
      --card:#fff;
      --text:#111;
      --muted:#555;
      --border:#e8e8e8;
      --shadow: 0 8px 26px rgba(0,0,0,.06);
      --radius:16px;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--text);
      line-height:1.45;
    }
    a { color:inherit; }
    .wrap { max-width:980px; margin:0 auto; padding:22px 16px 64px; }

    header {
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    h1 { margin:0; font-size:34px; letter-spacing:-.5px; }
    .sub {
      color:var(--muted);
      margin-top:6px;
      font-size:14px;
    }
    .nav {
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
      font-size:13px;
      color:var(--muted);
    }
    .nav a { text-decoration:underline; color:var(--muted); }

    .top-grid {
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin:14px 0 18px;
    }
    @media (max-width: 860px) { .top-grid { grid-template-columns:1fr; } }

    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px 14px;
    }

    .photo-card { padding:0; overflow:hidden; }
    .photo-meta { padding:12px 12px 13px; }
    .photo-title { font-weight:650; font-size:14px; margin:0 0 6px; }
    .photo-sub { font-size:12.5px; color:var(--muted); display:flex; gap:8px; flex-wrap:wrap; }
    .photo-img {
      width:100%;
      height:170px;
      object-fit:cover;
      display:block;
      cursor:pointer;
    }
    .pill {
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 10px;
      font-size:12.5px;
      color:var(--muted);
      background:#fff;
    }

    .controls {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin:10px 0 10px;
    }
    .btns { display:flex; gap:8px; flex-wrap:wrap; }
    button {
      border:1px solid var(--border);
      background:#fff;
      color:var(--text);
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      cursor:pointer;
    }
    button.active { border-color:#111; }
    .small { font-size:12.5px; color:var(--muted); }

    .news { display:flex; flex-direction:column; gap:12px; }
    .news-item h3 {
      margin:0 0 6px;
      font-size:18px;
      letter-spacing:-.2px;
    }
    .news-item h3 a { text-decoration:none; }
    .news-item h3 a:hover { text-decoration:underline; }
    .meta { font-size:12.5px; color:var(--muted); }
    .summary { margin-top:8px; font-size:14px; color:#222; }
    .hr { height:1px; background:var(--border); margin:18px 0; }

    details { margin-top:12px; }
    summary { cursor:pointer; color:var(--muted); font-size:13px; }
    .section-title { margin:18px 0 10px; font-size:20px; letter-spacing:-.3px; }
    .foot { margin-top:26px; color:var(--muted); font-size:12.5px; }
    code { background:#fff; border:1px solid var(--border); padding:2px 6px; border-radius:8px; }

    /* tiny modal (for photos) */
    .modal {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal.open { display:flex; }
    .modal-box {
      max-width:980px;
      width:100%;
      background:#111;
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
    }
    .modal-img { width:100%; display:block; max-height:78vh; object-fit:contain; background:#000; }
    .modal-bar {
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      color:#eee;
      font-size:13px;
      background:#0b0b0b;
    }
    .modal-bar a { color:#eee; text-decoration:underline; }
    .modal-close {
      border:1px solid rgba(255,255,255,.2);
      background:transparent;
      color:#eee;
      border-radius:999px;
      padding:6px 10px;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Ve»ôti bune</h1>
        <div class="sub">Rom√¢nia (RO) + Global (EN). Actualizat automat.</div>
      </div>
      <div class="nav">
        <a href="./about.html">About</a>
        <span>‚Ä¢</span>
        <a href="./data/items.json">Data</a>
      </div>
    </header>

    <!-- Top: Photos + Joke + Satire -->
    <div id="topGrid" class="top-grid"></div>

    <div class="controls">
      <div class="btns">
        <button id="btnMix" class="active">‚ú® Mix</button>
        <button id="btnRO">üá∑üá¥ Rom√¢nia</button>
        <button id="btnEN">üåç Global (EN)</button>
      </div>
      <div class="small" id="lastUpdated">‚Äî</div>
    </div>

    <div id="news" class="news"></div>

    <div class="hr"></div>

    <details open>
      <summary>Sec»õiuni (Rom√¢nia / »òtiin»õƒÉ / Mediu)</summary>
      <div id="sections"></div>
    </details>

    <div class="foot">
      Tip: dacƒÉ vezi versiune veche, fƒÉ hard refresh (<code>Cmd+Shift+R</code> / <code>Ctrl+F5</code>).
    </div>
  </div>

  <!-- Photo modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Imagine">
    <div class="modal-box">
      <img id="modalImg" class="modal-img" alt="Imagine" />
      <div class="modal-bar">
        <div id="modalText">‚Äî</div>
        <div style="display:flex; gap:10px; align-items:center;">
          <a id="modalOpen" href="#" target="_blank" rel="noopener noreferrer">Deschide</a>
          <button id="modalClose" class="modal-close">√énchide</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- helpers ---
    const $ = (id) => document.getElementById(id);

    function el(tag, attrs = {}, children = null) {
      const node = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs || {})) {
        if (k === "class") node.className = v;
        else if (k === "html") node.innerHTML = v;
        else node.setAttribute(k, v);
      }
      if (children === null || children === undefined) return node;
      if (Array.isArray(children)) children.forEach(c => node.appendChild(typeof c === "string" ? document.createTextNode(c) : c));
      else node.appendChild(typeof children === "string" ? document.createTextNode(children) : children);
      return node;
    }

    function cardBase() {
      return "background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;";
    }

    async function fetchJSON(url) {
      // cache-bust ca sƒÉ nu te love»ôti de caching agresiv
      const u = url + (url.includes("?") ? "&" : "?") + "v=" + Date.now();
      const r = await fetch(u, { cache: "no-store" });
      if (!r.ok) throw new Error("Fetch failed: " + r.status);
      return await r.json();
    }

    function fmtDate(iso) {
      try {
        const d = new Date(iso);
        return d.toLocaleString("ro-RO");
      } catch (e) {
        return iso || "";
      }
    }

    // --- render: photo modal ---
    function openModal(imgUrl, pageUrl, title) {
      $("modalImg").src = imgUrl;
      $("modalOpen").href = pageUrl || imgUrl;
      $("modalText").textContent = title || "";
      $("modal").classList.add("open");
    }
    function closeModal() {
      $("modal").classList.remove("open");
      $("modalImg").src = "";
      $("modalOpen").href = "#";
      $("modalText").textContent = "";
    }

    $("modalClose").addEventListener("click", closeModal);
    $("modal").addEventListener("click", (e) => {
      if (e.target === $("modal")) closeModal();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeModal();
    });

    // --- render: top blocks ---
    function renderTopBlocks(sections) {
      const grid = $("topGrid");
      grid.innerHTML = "";

      const photos = (sections.photos || []).slice(0, 3);
      const joke = (sections.joke && sections.joke[0]) ? sections.joke[0] : null;
      const satire = (sections.satire && sections.satire[0]) ? sections.satire[0] : null;

      // 3 photo cards
      if (photos.length) {
        photos.forEach(p => {
          const img = el("img", {
            class: "photo-img",
            src: p.image_url || "",
            alt: p.title || "PozƒÉ",
            loading: "lazy"
          });
          img.addEventListener("click", () => openModal(p.image_url, p.link || p.image_url, p.category_label + " ‚Äî " + (p.title || "")));

          const card = el("div", { class: "card photo-card" }, [
            img,
            el("div", { class: "photo-meta" }, [
              el("div", { class: "photo-title" }, (p.category_label || "üì∑") + " ‚Äî " + (p.title || "")),
              el("div", { class: "photo-sub" }, [
                el("span", {}, p.source || ""),
                el("span", {}, "‚Ä¢"),
                el("span", {}, fmtDate(p.published_utc)),
                el("span", {}, "‚Ä¢"),
                el("a", {
                  href: p.link || p.image_url || "#",
                  target: "_blank",
                  rel: "noopener noreferrer",
                  style: "text-decoration:underline;color:var(--muted);"
                }, "Sursa")
              ])
            ])
          ]);
          grid.appendChild(card);
        });
      } else {
        grid.appendChild(el("div", { class: "card" }, "Pozele zilei nu sunt disponibile √ÆncƒÉ."));
      }

      // joke card
      const jokeCard = el("div", { class: "card" }, [
        el("div", { style: "font-weight:650;margin-bottom:8px;" }, "üòÑ Bancul zilei"),
        el("div", { style: "font-size:14px;color:#222;line-height:1.5;" }, joke ? (joke.text || "") : "‚Äî")
      ]);

      // satire card
      const satireCard = el("div", { class: "card" }, [
        el("div", { style: "font-weight:650;margin-bottom:8px;" }, "üì∞ SatirƒÉ (TimesNewRoman)"),
        satire ? el("div", {}, [
          el("div", { style: "font-size:14px;color:#222;line-height:1.5;font-weight:650;" }, satire.title || "‚Äî"),
          el("div", { style: "margin-top:8px;font-size:13px;color:#333;line-height:1.45;max-height:70px;overflow:hidden;" }, satire.summary || ""),
          el("div", { style: "margin-top:10px;font-size:12.5px;color:var(--muted);" , html:
            `<a href="${satire.link}" target="_blank" rel="noopener noreferrer" style="color:var(--muted);text-decoration:underline">Deschide articol</a>
             <span style="opacity:.8"> ‚Ä¢ ${satire.note || "SatirƒÉ ‚Äî nu este »ôtire realƒÉ."}</span>`
          })
        ]) : el("div", { class: "small" }, "‚Äî")
      ]);

      // on desktop we already have 3 photos in row; on mobile it becomes column; add joke+satire below via normal flow:
      // But top-grid is 3 cols; we append exactly 3 photos already.
      // We'll add a second row below the grid:
      const wrap2 = el("div", { style: "display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;" });
      wrap2.appendChild(jokeCard);
      wrap2.appendChild(satireCard);

      // responsive fallback
      if (window.innerWidth <= 860) wrap2.setAttribute("style", "display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px;");

      grid.parentNode.insertBefore(wrap2, grid.nextSibling);
    }

    // --- render: news item ---
    function renderNewsItem(it) {
      const d = new Date(it.published_utc || it.date_utc || "");
      const title = it.title || "";
      const summary = it.summary || "";

      const card = el("div", { class: "card news-item" });

      const h = el("h3", {}, el("a", {
        href: it.link || "#",
        target: "_blank",
        rel: "noopener noreferrer"
      }, title));
      card.appendChild(h);

      const meta = el("div", { class: "meta" });
      if (it.kind === "global") {
        meta.innerHTML =
          `üåç EN ‚Ä¢ ${it.source || ""} ‚Ä¢ ${d.toLocaleString("ro-RO")} ‚Ä¢ ` +
          `<a href="${it.link}" target="_blank" rel="noopener noreferrer" style="color:#555;text-decoration:underline">Original</a>`;
      } else {
        meta.textContent = `üá∑üá¥ RO ‚Ä¢ ${it.source || ""} ‚Ä¢ ${d.toLocaleString("ro-RO")}`;
      }
      card.appendChild(meta);

      if (summary) {
        card.appendChild(el("div", { class: "summary" }, summary));
      }
      return card;
    }

    function renderFeed(items) {
      const root = $("news");
      root.innerHTML = "";
      if (!items || !items.length) {
        root.appendChild(el("div", { class: "card" }, "Nu sunt »ôtiri √ÆncƒÉ."));
        return;
      }
      items.slice(0, 30).forEach(it => root.appendChild(renderNewsItem(it)));
    }

    // --- render: sections below ---
    function renderSections(sections) {
      const root = $("sections");
      root.innerHTML = "";

      function renderSection(label, key) {
        const arr = sections[key] || [];
        root.appendChild(el("div", { class: "section-title" }, label));
        if (!arr.length) {
          root.appendChild(el("div", { class: "card" }, "‚Äî"));
          return;
        }
        arr.slice(0, 12).forEach(it => root.appendChild(renderNewsItem(it)));
      }

      renderSection("üá∑üá¥ Rom√¢nia", "romania");
      renderSection("üî¨ »òtiin»õƒÉ (EN)", "science");
      renderSection("üåø Mediu (EN)", "environment");
      // medical poate fi gol momentan
      if ((sections.medical || []).length) renderSection("ü©∫ Medical (EN)", "medical");
    }

    // --- controls ---
    function applyFilter(allItems, mode) {
      if (mode === "mix") return allItems;
      if (mode === "ro") return (allItems || []).filter(x => x.kind !== "global");
      if (mode === "en") return (allItems || []).filter(x => x.kind === "global");
      return allItems;
    }

    function setActive(btnId) {
      ["btnMix", "btnRO", "btnEN"].forEach(id => $(id).classList.remove("active"));
      $(btnId).classList.add("active");
    }

    // --- main ---
    async function main() {
      const data = await fetchJSON("data/items.json");
      const sections = data.sections || {};
      const items = data.items || [];

      $("lastUpdated").textContent = "Ultimul refresh: " + fmtDate(data.generated_utc || "");

      // render top blocks (photos + joke + satire)
      // NOTE: renderTopBlocks adds a second row beneath topGrid; to avoid duplicates on reload, clean it
      // quick cleanup: remove any sibling grid we created before
      const grid = $("topGrid");
      // remove the row after grid if it exists and has our structure
      if (grid.nextSibling && grid.nextSibling.nodeType === 1 && grid.nextSibling.querySelector && grid.nextSibling.querySelector(".card")) {
        // try to only remove if it contains our "Bancul zilei"
        const txt = grid.nextSibling.textContent || "";
        if (txt.includes("Bancul zilei") || txt.includes("SatirƒÉ")) {
          grid.parentNode.removeChild(grid.nextSibling);
        }
      }
      renderTopBlocks(sections);

      // default: MIX
      renderFeed(items);

      $("btnMix").addEventListener("click", () => {
        setActive("btnMix");
        renderFeed(applyFilter(items, "mix"));
      });
      $("btnRO").addEventListener("click", () => {
        setActive("btnRO");
        renderFeed(applyFilter(items, "ro"));
      });
      $("btnEN").addEventListener("click", () => {
        setActive("btnEN");
        renderFeed(applyFilter(items, "en"));
      });

      // sections below
      renderSections(sections);
    }

    main().catch(err => {
      $("news").innerHTML = "";
      $("news").appendChild(el("div", { class:"card" }, "Eroare la √ÆncƒÉrcare: " + err.message));
      console.error(err);
    });
  </script>
</body>
</html>
