<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ve»ôti bune</title>
  <meta name="description" content="Rom√¢nia (RO) + Global (EN). Ve»ôti curate, actualizate automat." />
  <meta name="theme-color" content="#0b0b0f" />
  <style>
    :root{
      --bg:#0b0b0f;
      --panel:#12121a;
      --panel2:#171724;
      --text:#f2f2f7;
      --muted:#b7b7c7;
      --muted2:#8b8ba1;
      --border:rgba(255,255,255,.10);
      --border2:rgba(255,255,255,.14);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --r:18px;
      --r2:14px;
      --max: 1180px;
      --btn:#1b1b2a;
      --btn2:#23233a;
      --ok:#2be27a;
      --warn:#ffcc66;
      --bad:#ff6b6b;
      --link:#9fd3ff;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 0%, rgba(90,60,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 90% 15%, rgba(0,255,200,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }
    .wrap{ max-width: var(--max); margin:0 auto; padding: 18px 14px 60px; }
    header{
      display:flex;
      gap:14px;
      align-items:flex-end;
      justify-content:space-between;
      padding: 10px 6px 14px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .brand h1{
      margin:0;
      font-size: 26px;
      letter-spacing:.2px;
    }
    .brand .sub{
      color:var(--muted);
      font-size: 14px;
    }
    .pillrow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      padding:8px 10px;
      border-radius: 999px;
      font-size: 12px;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .pill b{ color:var(--text); font-weight:600; }
    .grid3{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 6px 0 14px;
    }
    .card{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .photo{
      position:relative;
      aspect-ratio: 16/10;
      background:#111;
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:saturate(1.05) contrast(1.05);
    }
    .photo .tag{
      position:absolute;
      left:10px;
      top:10px;
      background: rgba(0,0,0,.45);
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size: 12px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .photo .tag .dot{
      width:8px; height:8px; border-radius:999px; background: var(--ok);
      box-shadow: 0 0 0 3px rgba(43,226,122,.18);
    }
    .card .body{
      padding: 12px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .card .title{
      font-size: 14px;
      font-weight: 700;
      letter-spacing:.1px;
      margin:0;
    }
    .card .small{
      color:var(--muted);
      font-size: 12px;
      margin:0;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 10px 0 18px;
    }
    .mini{
      padding: 14px 14px 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .mini h2{
      margin:0 0 8px;
      font-size: 16px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .mini h2 span{
      font-size:12px;
      color:var(--muted);
      font-weight:600;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      padding: 4px 8px;
      border-radius:999px;
    }
    .mini .txt{
      margin:0;
      color:var(--text);
      font-size: 14px;
    }
    .mini .src{
      margin:10px 0 0;
      font-size: 12px;
      color:var(--muted);
    }
    .mini .src a{ color: var(--link); }

    .controls{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin: 10px 0 10px;
    }
    .btnrow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    button{
      border:1px solid var(--border);
      background: var(--btn);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
    }
    button:hover{ background: var(--btn2); }
    button.active{
      border-color: rgba(43,226,122,.55);
      box-shadow: 0 0 0 4px rgba(43,226,122,.12);
      background: rgba(43,226,122,.10);
    }
    .status{
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .status code{
      color: var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      padding: 3px 6px;
      border-radius: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
    }

    .sections{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 10px;
    }

    .section{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border-radius: var(--r);
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .sectionhead{
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
      background: rgba(255,255,255,.03);
    }
    .sectionhead h3{
      margin:0;
      font-size: 15px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .badge{
      font-size: 11px;
      color: var(--muted);
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      padding: 4px 8px;
      border-radius:999px;
      font-weight:600;
    }
    .items{
      display:grid;
      grid-template-columns: 1fr;
    }
    .item{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      padding: 12px 14px;
      border-top: 1px solid rgba(255,255,255,.06);
      align-items:start;
    }
    .item:first-child{ border-top:0; }
    .thumb{
      width:140px;
      aspect-ratio: 16/10;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: #0f0f16;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .meta{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }
    .meta .t{
      margin:0;
      font-weight: 800;
      font-size: 14px;
      letter-spacing:.1px;
      line-height: 1.25;
    }
    .meta .s{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      overflow-wrap:anywhere;
    }
    .meta .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color: var(--muted2);
      font-size: 12px;
    }
    .dot{
      width:6px; height:6px; border-radius:999px; background: rgba(255,255,255,.28);
      display:inline-block;
    }
    .k{
      padding: 3px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight:700;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing:.6px;
    }
    .k.ro{ border-color: rgba(159,211,255,.35); background: rgba(159,211,255,.08); }
    .k.en{ border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.10); }

    footer{
      margin-top: 26px;
      color: var(--muted2);
      font-size: 12px;
      text-align:center;
      padding: 18px 0 0;
    }
    footer a{ color: var(--link); }
    @media (max-width: 920px){
      .grid3{ grid-template-columns: 1fr; }
      .grid2{ grid-template-columns: 1fr; }
      .item{ grid-template-columns: 1fr; }
      .thumb{ width:100%; }
      header{ align-items:flex-start; flex-direction:column; }
      .pillrow{ justify-content:flex-start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Ve»ôti bune</h1>
        <div class="sub">Rom√¢nia (RO) + Global (EN). Actualizat automat. ‚ù§Ô∏è</div>
      </div>
      <div class="pillrow">
        <div class="pill"><b>Mix</b> RO + EN</div>
        <div class="pill"><b>Tip</b> hard refresh <code>Cmd+Shift+R</code></div>
        <div class="pill"><b>Date</b> <a href="./data/news.json" target="_blank" rel="noopener">news.json</a></div>
      </div>
    </header>

    <!-- TOP PHOTOS -->
    <div class="grid3" id="topPhotos">
      <div class="card">
        <div class="photo">
          <img alt="Space" src="https://source.unsplash.com/featured/1200x800/?space,stars,nebula" />
          <div class="tag"><span class="dot"></span> Space</div>
        </div>
        <div class="body">
          <p class="title">Top poze</p>
          <p class="small">space / animals / landscape</p>
        </div>
      </div>

      <div class="card">
        <div class="photo">
          <img alt="Animals" src="https://source.unsplash.com/featured/1200x800/?animals,cute" />
          <div class="tag"><span class="dot"></span> Animals</div>
        </div>
        <div class="body">
          <p class="title">Doar vibe bun</p>
          <p class="small">poze fresh, fƒÉrƒÉ API keys</p>
        </div>
      </div>

      <div class="card">
        <div class="photo">
          <img alt="Landscape" src="https://source.unsplash.com/featured/1200x800/?landscape,nature,mountains" />
          <div class="tag"><span class="dot"></span> Landscape</div>
        </div>
        <div class="body">
          <p class="title">Reset mental</p>
          <p class="small">3 carduri sus, ca √Ænainte</p>
        </div>
      </div>
    </div>

    <!-- JOKE + SATIRE -->
    <div class="grid2">
      <div class="mini" id="jokeBox">
        <h2>Gluma zilei <span>RO</span></h2>
        <p class="txt" id="jokeText">Se √ÆncarcƒÉ‚Ä¶</p>
        <p class="src">SursƒÉ: <a href="#" id="jokeSrc" target="_blank" rel="noopener">random intern (offline-safe)</a></p>
      </div>

      <div class="mini" id="satireBox">
        <h2>Satira zilei <span>RO</span></h2>
        <p class="txt" id="satireText">Se √ÆncarcƒÉ‚Ä¶</p>
        <p class="src">SursƒÉ: <a href="#" id="satireSrc" target="_blank" rel="noopener">link (manual)</a></p>
      </div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
      <div class="btnrow">
        <button id="btnMix" class="active" type="button">‚ú® Mix</button>
        <button id="btnRO" type="button">üá∑üá¥ RO</button>
        <button id="btnEN" type="button">üåç EN</button>
      </div>
      <div class="status">
        <span id="statusText">Se √ÆncarcƒÉ »ôtirile‚Ä¶</span>
        <span>‚Ä¢</span>
        <span>Ultima actualizare: <code id="generatedUtc">‚Äî</code></span>
      </div>
    </div>

    <!-- FEED -->
    <div class="sections" id="sections"></div>

    <footer>
      DacƒÉ ‚Äúpare stricat‚Äù, fƒÉ <b>hard refresh</b>. DacƒÉ tot nu revine, verificƒÉ sƒÉ fie Pages pe <b>main / root</b>. ‚Ä¢
      <a href="https://github.com/vcarciu/vesti-bune" target="_blank" rel="noopener">Repo</a>
    </footer>
  </div>

  <script>
    // ========= Helpers =========
    const $ = (sel) => document.querySelector(sel);
    const escapeHTML = (s) => (s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    const toDate = (iso) => {
      try {
        const d = new Date(iso);
        return d.toLocaleString("ro-RO", { year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit" });
      } catch { return iso || ""; }
    };
    const hostOf = (url) => {
      try { return new URL(url).hostname.replace(/^www\./,''); } catch { return ""; }
    };

    // ========= Joke + Satire (offline-safe, deterministic daily) =========
    const jokes = [
      { t: "‚Äî De ce QA-ul nu merge la petreceri? ‚Äî Pentru cƒÉ mereu gƒÉse»ôte bug-uri √Æn atmosferƒÉ.", u: "https://en.wikipedia.org/wiki/Software_testing" },
      { t: "DacƒÉ totul pare ok‚Ä¶ √ÆnseamnƒÉ cƒÉ n-ai testat suficient.", u: "https://en.wikipedia.org/wiki/Quality_assurance" },
      { t: "Am √Æncercat sƒÉ fiu pozitiv. A ie»ôit un test case cu 0 pa»ôi »ôi 3 a»ôteptƒÉri.", u: "https://en.wikipedia.org/wiki/Test_case" },
      { t: "Veste bunƒÉ: am reparat bug-ul. Veste »ôi mai bunƒÉ: am gƒÉsit √ÆncƒÉ 5!", u: "https://en.wikipedia.org/wiki/Debugging" }
    ];
    const satire = [
      { t: "Breaking: Rom√¢nia intrƒÉ √Æn topul mondial la optimism‚Ä¶ dupƒÉ ce a dezinstalat notificƒÉrile.", u: "https://en.wikipedia.org/wiki/Satire" },
      { t: "S-a descoperit o metodƒÉ nouƒÉ de productivitate: √Ænchizi 3 tab-uri »ôi te sim»õi ca »ôi cum ai terminat proiectul.", u: "https://en.wikipedia.org/wiki/Procrastination" },
      { t: "Un studiu aratƒÉ cƒÉ 9 din 10 oameni preferƒÉ ve»ôtile bune. Al 10-lea preferƒÉ sƒÉ se pl√¢ngƒÉ cƒÉ sunt prea pu»õine.", u: "https://en.wikipedia.org/wiki/Negativity_bias" },
      { t: "Economi»ôtii confirmƒÉ: dacƒÉ nu verifici contul, cheltuielile scad cu 100%.", u: "https://en.wikipedia.org/wiki/Behavioral_economics" }
    ];
    function pickDaily(arr){
      const d = new Date();
      const key = Number(`${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`);
      return arr[key % arr.length];
    }
    const j = pickDaily(jokes);
    $("#jokeText").textContent = j.t;
    $("#jokeSrc").href = j.u;

    const s = pickDaily(satire);
    $("#satireText").textContent = s.t;
    $("#satireSrc").href = s.u;

    // ========= Data + Rendering =========
    const state = {
      mode: "mix", // mix | ro | en
      data: null
    };

    function sectionLabel(key){
      const map = {
        romania: "Rom√¢nia",
        medical: "Medical",
        science: "»òtiin»õƒÉ",
        environment: "Mediu",
        tech: "Tech",
        business: "Business",
        culture: "CulturƒÉ",
        sports: "Sport",
        funny: "Fun",
      };
      return map[key] || (key.charAt(0).toUpperCase() + key.slice(1));
    }

    function isRO(item){ return (item.kind === "ro") || (item.section === "romania"); }
    function isEN(item){ return (item.kind === "global") || (!isRO(item)); }

    function normalizeSections(raw){
      // raw: { generated_utc, sections: { key: [items...] } }
      const out = { generated_utc: raw.generated_utc, sections: {} };
      const secs = raw.sections || {};
      for (const [k, arr] of Object.entries(secs)){
        out.sections[k] = (arr || []).map(x => ({
          section: x.section || k,
          kind: x.kind || (k === "romania" ? "ro" : "global"),
          source: x.source || hostOf(x.link),
          title: x.title || "",
          summary: x.summary || "",
          link: x.link || "#",
          published_utc: x.published_utc || "",
          score: typeof x.score === "number" ? x.score : null,
          image: x.image || null
        }));
      }
      return out;
    }

    function buildMixed(sections){
      // produce one "mix" stream grouped back into sections (keep same section keys)
      const mixed = {};
      for (const [k, arr] of Object.entries(sections)){
        mixed[k] = [...arr].sort((a,b) => (b.published_utc||"").localeCompare(a.published_utc||""));
      }
      return mixed;
    }

    function filterByMode(allSections, mode){
      const filtered = {};
      for (const [k, arr] of Object.entries(allSections)){
        let a = arr;
        if (mode === "ro") a = arr.filter(isRO);
        if (mode === "en") a = arr.filter(isEN);
        // pƒÉstreazƒÉ sec»õiunea doar dacƒÉ are elemente
        if (a.length) filtered[k] = a;
      }
      return filtered;
    }

    function render(sections){
      const root = $("#sections");
      root.innerHTML = "";

      const keys = Object.keys(sections);
      if (!keys.length){
        root.innerHTML = `<div class="mini"><h2>Nu sunt »ôtiri pentru filtrul ales</h2><p class="txt">√éncearcƒÉ <b>Mix</b> sau adaugƒÉ surse.</p></div>`;
        return;
      }

      for (const k of keys){
        const arr = sections[k];
        const box = document.createElement("div");
        box.className = "section";
        box.innerHTML = `
          <div class="sectionhead">
            <h3>${escapeHTML(sectionLabel(k))}</h3>
            <span class="badge">${arr.length} articole</span>
          </div>
          <div class="items"></div>
        `;
        const itemsEl = box.querySelector(".items");

        for (const it of arr){
          const kindClass = isRO(it) ? "ro" : "en";
          const kindText = isRO(it) ? "RO" : "EN";
          const imgHTML = it.image
            ? `<div class="thumb"><img loading="lazy" alt="" src="${escapeHTML(it.image)}" /></div>`
            : `<div class="thumb"><img loading="lazy" alt="" src="https://source.unsplash.com/featured/800x500/?good,news" /></div>`;

          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            ${imgHTML}
            <div class="meta">
              <p class="t"><a target="_blank" rel="noopener" href="${escapeHTML(it.link)}">${escapeHTML(it.title)}</a></p>
              <p class="s">${escapeHTML(it.summary)}</p>
              <div class="row">
                <span class="k ${kindClass}">${kindText}</span>
                <span class="dot"></span>
                <span>${escapeHTML(it.source || hostOf(it.link))}</span>
                <span class="dot"></span>
                <span>${escapeHTML(toDate(it.published_utc))}</span>
              </div>
            </div>
          `;
          itemsEl.appendChild(el);
        }

        root.appendChild(box);
      }
    }

    function setMode(mode){
      state.mode = mode;
      $("#btnMix").classList.toggle("active", mode === "mix");
      $("#btnRO").classList.toggle("active", mode === "ro");
      $("#btnEN").classList.toggle("active", mode === "en");

      const all = state.data?.sections || {};
      const filtered = filterByMode(all, mode);
      render(filtered);

      const count = Object.values(filtered).reduce((acc, a) => acc + a.length, 0);
      $("#statusText").textContent = `Afi»ôez: ${count} articole ‚Ä¢ Filtru: ${mode.toUpperCase()}`;
    }

    async function load(){
      try{
        $("#statusText").textContent = "Se √ÆncarcƒÉ »ôtirile‚Ä¶";
        const res = await fetch("./data/news.json", { cache: "no-store" });
        if (!res.ok) throw new Error("Nu pot √ÆncƒÉrca data/news.json");
        const raw = await res.json();
        const norm = normalizeSections(raw);
        state.data = { generated_utc: norm.generated_utc, sections: buildMixed(norm.sections) };

        $("#generatedUtc").textContent = state.data.generated_utc || "‚Äî";
        setMode(state.mode);
      }catch(e){
        console.error(e);
        $("#statusText").textContent = "Eroare la √ÆncƒÉrcarea »ôtirilor.";
        $("#sections").innerHTML = `
          <div class="mini">
            <h2>Nu pot √ÆncƒÉrca datele</h2>
            <p class="txt">VerificƒÉ dacƒÉ existƒÉ <code>data/news.json</code> »ôi cƒÉ Pages serve»ôte din <b>main / root</b>.</p>
          </div>
        `;
      }
    }

    // ========= Events =========
    $("#btnMix").addEventListener("click", () => setMode("mix"));
    $("#btnRO").addEventListener("click", () => setMode("ro"));
    $("#btnEN").addEventListener("click", () => setMode("en"));

    load();
  </script>
</body>
</html>
